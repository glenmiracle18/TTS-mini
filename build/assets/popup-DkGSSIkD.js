var G={exports:{}},$={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B;function oe(){if(B)return $;B=1;var c=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function S(v,l,T){var p=null;if(T!==void 0&&(p=""+T),l.key!==void 0&&(p=""+l.key),"key"in l){T={};for(var E in l)E!=="key"&&(T[E]=l[E])}else T=l;return l=T.ref,{$$typeof:c,type:v,key:p,ref:l!==void 0?l:null,props:T}}return $.Fragment=m,$.jsx=S,$.jsxs=S,$}var F;function ue(){return F||(F=1,G.exports=oe()),G.exports}var u=ue(),D={exports:{}},n={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q;function ie(){if(Q)return n;Q=1;var c=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),p=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),C=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),b=Symbol.iterator;function w(e){return e===null||typeof e!="object"?null:(e=b&&e[b]||e["@@iterator"],typeof e=="function"?e:null)}var P={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,k={};function O(e,t,s){this.props=e,this.context=t,this.refs=k,this.updater=s||P}O.prototype.isReactComponent={},O.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},O.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function M(){}M.prototype=O.prototype;function o(e,t,s){this.props=e,this.context=t,this.refs=k,this.updater=s||P}var h=o.prototype=new M;h.constructor=o,A(h,O.prototype),h.isPureReactComponent=!0;var x=Array.isArray;function g(){}var f={H:null,A:null,T:null,S:null},J=Object.prototype.hasOwnProperty;function Y(e,t,s){var r=s.ref;return{$$typeof:c,type:e,key:t,ref:r!==void 0?r:null,props:s}}function K(e,t){return Y(e.type,t,e.props)}function L(e){return typeof e=="object"&&e!==null&&e.$$typeof===c}function ee(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var z=/\/+/g;function q(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ee(""+e.key):t.toString(36)}function te(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(g,g):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function H(e,t,s,r,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(a){case"bigint":case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case c:case m:d=!0;break;case j:return d=e._init,H(d(e._payload),t,s,r,i)}}if(d)return i=i(e),d=r===""?"."+q(e,0):r,x(i)?(s="",d!=null&&(s=d.replace(z,"$&/")+"/"),H(i,t,s,"",function(se){return se})):i!=null&&(L(i)&&(i=K(i,s+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(z,"$&/")+"/")+d)),t.push(i)),1;d=0;var N=r===""?".":r+":";if(x(e))for(var _=0;_<e.length;_++)r=e[_],a=N+q(r,_),d+=H(r,t,s,a,i);else if(_=w(e),typeof _=="function")for(e=_.call(e),_=0;!(r=e.next()).done;)r=r.value,a=N+q(r,_++),d+=H(r,t,s,a,i);else if(a==="object"){if(typeof e.then=="function")return H(te(e),t,s,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return d}function U(e,t,s){if(e==null)return e;var r=[],i=0;return H(e,r,"","",function(a){return t.call(s,a,i++)}),r}function ne(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var V=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},re={map:U,forEach:function(e,t,s){U(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return U(e,function(){t++}),t},toArray:function(e){return U(e,function(t){return t})||[]},only:function(e){if(!L(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return n.Activity=I,n.Children=re,n.Component=O,n.Fragment=S,n.Profiler=l,n.PureComponent=o,n.StrictMode=v,n.Suspense=y,n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=f,n.__COMPILER_RUNTIME={__proto__:null,c:function(e){return f.H.useMemoCache(e)}},n.cache=function(e){return function(){return e.apply(null,arguments)}},n.cacheSignal=function(){return null},n.cloneElement=function(e,t,s){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=A({},e.props),i=e.key;if(t!=null)for(a in t.key!==void 0&&(i=""+t.key),t)!J.call(t,a)||a==="key"||a==="__self"||a==="__source"||a==="ref"&&t.ref===void 0||(r[a]=t[a]);var a=arguments.length-2;if(a===1)r.children=s;else if(1<a){for(var d=Array(a),N=0;N<a;N++)d[N]=arguments[N+2];r.children=d}return Y(e.type,i,r)},n.createContext=function(e){return e={$$typeof:p,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:T,_context:e},e},n.createElement=function(e,t,s){var r,i={},a=null;if(t!=null)for(r in t.key!==void 0&&(a=""+t.key),t)J.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var d=arguments.length-2;if(d===1)i.children=s;else if(1<d){for(var N=Array(d),_=0;_<d;_++)N[_]=arguments[_+2];i.children=N}if(e&&e.defaultProps)for(r in d=e.defaultProps,d)i[r]===void 0&&(i[r]=d[r]);return Y(e,a,i)},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:E,render:e}},n.isValidElement=L,n.lazy=function(e){return{$$typeof:j,_payload:{_status:-1,_result:e},_init:ne}},n.memo=function(e,t){return{$$typeof:C,type:e,compare:t===void 0?null:t}},n.startTransition=function(e){var t=f.T,s={};f.T=s;try{var r=e(),i=f.S;i!==null&&i(s,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(g,V)}catch(a){V(a)}finally{t!==null&&s.types!==null&&(t.types=s.types),f.T=t}},n.unstable_useCacheRefresh=function(){return f.H.useCacheRefresh()},n.use=function(e){return f.H.use(e)},n.useActionState=function(e,t,s){return f.H.useActionState(e,t,s)},n.useCallback=function(e,t){return f.H.useCallback(e,t)},n.useContext=function(e){return f.H.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e,t){return f.H.useDeferredValue(e,t)},n.useEffect=function(e,t){return f.H.useEffect(e,t)},n.useEffectEvent=function(e){return f.H.useEffectEvent(e)},n.useId=function(){return f.H.useId()},n.useImperativeHandle=function(e,t,s){return f.H.useImperativeHandle(e,t,s)},n.useInsertionEffect=function(e,t){return f.H.useInsertionEffect(e,t)},n.useLayoutEffect=function(e,t){return f.H.useLayoutEffect(e,t)},n.useMemo=function(e,t){return f.H.useMemo(e,t)},n.useOptimistic=function(e,t){return f.H.useOptimistic(e,t)},n.useReducer=function(e,t,s){return f.H.useReducer(e,t,s)},n.useRef=function(e){return f.H.useRef(e)},n.useState=function(e){return f.H.useState(e)},n.useSyncExternalStore=function(e,t,s){return f.H.useSyncExternalStore(e,t,s)},n.useTransition=function(){return f.H.useTransition()},n.version="19.2.0",n}var X;function ce(){return X||(X=1,D.exports=ie()),D.exports}var R=ce();const ae=({text:c,currentWordIndex:m,isSpeaking:S,onChange:v,theme:l})=>{const T=R.useMemo(()=>{if(!c)return[];const y=[];let C=0,j=0;const I=/(\S+|\s+)/g;let b;for(;(b=I.exec(c))!==null;){const w=b[1],P=j,A=j+w.length;if(w.trim()){let k;/^\d+(\.\d+)?$/.test(w)?k="number":/^[^\w\s]+$/.test(w)?k="punctuation":k="word",y.push({word:w,index:k==="word"?C++:-1,type:k,start:P,end:A})}else y.push({word:w,index:-1,type:"whitespace",start:P,end:A});j=A}return y},[c]),p=y=>{v(y.target.value)},E=()=>T.map((y,C)=>{const j=y.type==="word"&&y.index===m&&S,I=`token token-${y.type} ${j?"current-word":""}`;return u.jsx("span",{className:I,"data-word-index":y.index,children:y.word},C)});return u.jsxs("div",{className:`syntax-highlighter-container theme-${l}`,children:[u.jsx("div",{className:"syntax-highlight-overlay","aria-hidden":"true",children:u.jsx("div",{className:"syntax-content",children:E()})}),u.jsx("textarea",{value:c,onChange:p,placeholder:"Selected text will appear here. You can also type or paste text directly.","aria-label":"Text to read",className:"syntax-textarea",spellCheck:!1})]})},Z={rate:1,volume:1,theme:"system",syntaxHighlighting:!0},W="speechifyMiniPrefs_v1",le=c=>{const[m,S]=R.useState("light");return R.useEffect(()=>{const v=()=>{let l;c==="system"?l=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":l=c,S(l),document.documentElement.setAttribute("data-theme",l),document.body.className=`theme-${l}`};if(v(),c==="system"){const l=window.matchMedia("(prefers-color-scheme: dark)");return l.addEventListener("change",v),()=>l.removeEventListener("change",v)}},[c]),m},fe=async()=>new Promise(c=>{chrome.storage.sync.get([W],m=>{c({...Z,...m?.[W]||{}})})}),pe=async c=>{chrome.storage.sync.set({[W]:c})},de=async()=>{const[c]=await chrome.tabs.query({active:!0,currentWindow:!0});return c?.id},he=()=>{const[c,m]=R.useState(""),[S,v]=R.useState(!1),[l,T]=R.useState([]),[p,E]=R.useState(Z),[y,C]=R.useState(-1),j=R.useRef(null),I=le(p.theme);R.useEffect(()=>{fe().then(E)},[]),R.useEffect(()=>{const o=setTimeout(()=>pe(p),250);clearTimeout(o)},[p]),R.useEffect(()=>{const o=()=>{const h=speechSynthesis.getVoices().map((x,g)=>Object.assign(x,{id:x.voiceURI||String(g)}));if(T(h),h.length&&!p.voiceURI){const x=h.find(g=>g.lang?.toLowerCase().startsWith("en"));E(g=>({...g,voiceURI:x?.voiceURI||h[0].voiceURI}))}};return o(),speechSynthesis.onvoiceschanged=o,()=>{speechSynthesis.onvoiceschanged=null}},[p.voiceURI]),R.useEffect(()=>()=>{speechSynthesis.cancel()},[]);const b=R.useMemo(()=>l.find(o=>o.voiceURI===p.voiceURI),[l,p.voiceURI]),w=async()=>{try{const o=await de();if(!o){m("❌ No active tab found");return}m("⏳ Getting selection...");const x=await chrome.tabs.sendMessage(o,{type:"GET_SELECTION"})||"";x.trim()?m(x):m("⚠️ No text selected on page")}catch(o){console.error("Failed to get selection:",o),m("❌ Failed to get selection. Try reloading the page.")}},P=()=>{speechSynthesis.cancel(),v(!1),C(-1)},A=()=>{if(!c.trim())return;if(speechSynthesis.speaking){P(),setTimeout(A,0);return}const o=new SpeechSynthesisUtterance(c);o.rate=p.rate,o.volume=p.volume,b&&(o.voice=b);const h=c.split(/\s+/);o.onboundary=x=>{if(x.name==="word"||x.charIndex>=0){const g=c.slice(0,x.charIndex),f=g.trim()?g.trim().split(/\s+/).length-1:-1;C(Math.min(Math.max(f,0),h.length-1))}},o.onend=()=>{v(!1),C(-1)},o.onerror=()=>{v(!1),C(-1)},j.current=o,v(!0),speechSynthesis.speak(o)},k=()=>{speechSynthesis.speaking&&(speechSynthesis.paused?(speechSynthesis.resume(),v(!0)):(speechSynthesis.pause(),v(!1)))},O=()=>{const o=["system","light","dark"],h=o.indexOf(p.theme),x=o[(h+1)%o.length];E(g=>({...g,theme:x}))},M=()=>p.theme==="system"?"🔄":I==="dark"?"🌙":"☀️";return u.jsxs("div",{className:"container",children:[u.jsx("h3",{children:"Speechify Mini"}),u.jsx("button",{className:"theme-toggle",onClick:O,title:`Theme: ${p.theme} (click to cycle)`,children:M()}),u.jsx("div",{className:"small",children:'Select text on a page, then click "Grab Selection" to start reading.'}),u.jsxs("div",{className:"row",children:[u.jsx("button",{onClick:w,children:"📋 Grab Selection"}),u.jsx("button",{onClick:()=>m(""),children:"🗑️ Clear"})]}),p.syntaxHighlighting?u.jsx(ae,{text:c,currentWordIndex:y,isSpeaking:S,onChange:m,theme:I}):u.jsx("textarea",{value:c,onChange:o=>m(o.target.value),placeholder:"Selected text will appear here. You can also type or paste text directly.","aria-label":"Text to read",className:"syntax-textarea",style:{color:"var(--text-primary)",background:"var(--surface-color)"}}),u.jsxs("div",{className:"control-group",children:[u.jsxs("div",{className:"control-row",children:[u.jsx("label",{htmlFor:"voice",children:"Voice"}),u.jsx("select",{id:"voice",value:p.voiceURI||"",onChange:o=>E(h=>({...h,voiceURI:o.target.value})),children:l.length===0?u.jsx("option",{children:"Loading voices..."}):l.map(o=>u.jsxs("option",{value:o.voiceURI,children:[o.name," (",o.lang,")"]},o.id))})]}),u.jsxs("div",{className:"control-row",children:[u.jsxs("label",{htmlFor:"rate",children:["Speed ",p.rate.toFixed(1),"x"]}),u.jsx("input",{id:"rate",type:"range",min:.5,max:2,step:.1,value:p.rate,onChange:o=>E(h=>({...h,rate:Number(o.target.value)}))})]}),u.jsxs("div",{className:"control-row",children:[u.jsxs("label",{htmlFor:"vol",children:["Volume ",Math.round(p.volume*100),"%"]}),u.jsx("input",{id:"vol",type:"range",min:0,max:1,step:.05,value:p.volume,onChange:o=>E(h=>({...h,volume:Number(o.target.value)}))})]})]}),u.jsxs("div",{className:"row",children:[u.jsx("button",{onClick:A,disabled:!c.trim(),children:"▶️ Play"}),u.jsxs("button",{onClick:k,disabled:!speechSynthesis.speaking,children:["⏯️ ",speechSynthesis.paused?"Resume":"Pause"]}),u.jsx("button",{onClick:P,disabled:!S,children:"⏹️ Stop"})]}),S&&y>=0&&u.jsxs("div",{className:"status-indicator speaking",children:[u.jsx("span",{className:"speaking-indicator",children:"🎵"}),"Speaking word #",y+1]}),u.jsx("div",{className:"tips",children:u.jsxs("div",{className:"small",children:["💡 ",u.jsx("strong",{children:"Tips:"})," You can edit text directly before playback. Settings are automatically saved. Works best with English text."]})})]})};export{he as P,R as a,u as j,ce as r};
